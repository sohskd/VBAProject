'This module contains the Subroutine to generate the tables for each format'If there is a different format, a new subroutine has to be written for that format'If the format changes, the subroutine has to change
'Subroutine to generate IDR tables
Sub MakeTableIDR()
    Dim wb       As Workbook    Dim wbTarget As Workbook    Dim sheetTargetName As String    Dim WS_Count As Integer    Dim I As Integer        'Path of table template file eg "C:\Users\A9900899\Desktop\Desmond\VBAProject\"    tableTemplatePath = ThisWorkbook.Sheets("Sheet1").Range("D33")        'Table Formulas Template    Set wb = Workbooks.Open(tableTemplatePath & ThisWorkbook.Sheets("Sheet1").Range("D34"))    'Set wbTarget = Workbooks.Open("C:\Users\A9900899\Desktop\Desmond\VBAProject\TestFolder\Report.xlsx")        'Path of Target File eg "C:\Users\A9900899\Desktop\Desmond\VBAProject\"    targetPath = ThisWorkbook.Sheets("Sheet1").Range("C6")    'Name of File eg Report.xlsx    Set wbTarget = Workbooks.Open(targetPath & ThisWorkbook.Sheets("Sheet1").Range("C7"))    WS_Count = ActiveWorkbook.Worksheets.Count
    ' Begin the loop.    For I = 1 To WS_Count            wbTarget.Sheets(I).Select            If ActiveSheet.name = "NISP_IDR" Then            'Copy and Paste the format of table        With wb.Sheets("IDRTableTemplate").UsedRange            .Copy        End With                With wbTarget.Sheets(I).Range("D82")            .PasteSpecial        End With                'Make the formulas        ''''' Rates Table                        'Interbank Placement        '1M - 12M and the rest        wbTarget.Sheets(I).Range("G84").Select        ActiveCell.FormulaR1C1 = "=SUM(R[-72]C[1])+SUM(R[-66]C[1])*(R2C27/10^9)"        Range("G84").Select        Selection.AutoFill Destination:=Range("G84:K84"), Type:=xlFillDefault                '<1M        wbTarget.Sheets(I).Range("F84").Select        ActiveCell.FormulaR1C1 = "=(SUM(R[-72]C:R[-72]C[1])+SUM(R[-66]C:R[-66]C[1]))*(R2C27/10^9)"                '>1Y        wbTarget.Sheets(I).Range("L84").Select        ActiveCell.FormulaR1C1 = "=SUM(R[-72]C[1]:R[-72]C[8])+SUM(R[-66]C[1]:R[-66]C[8])*R2C27/10^9"                'Non-Rate        wbTarget.Sheets(I).Range("M84").Select        ActiveCell.FormulaR1C1 = "=SUM(R[-72]C[8]+R[-66]C[8])*R2C27/10^9"                'Total        wbTarget.Sheets(I).Range("N84").Select        ActiveCell.FormulaR1C1 = "=SUM(R[-0]C[-8]:R[-0]C[-1])"                          'Corporate Bonds        '1M - 12M and the rest        '<1M        '>1Y        'Non-Rate                'Total        wbTarget.Sheets(I).Range("N85").Select        ActiveCell.FormulaR1C1 = "=SUM(R[-0]C[-8]:R[-0]C[-1])"                                 'Government Bonds and T - Bills        '1M - 12M and the rest        wbTarget.Sheets(I).Range("G86").Select        ActiveCell.FormulaR1C1 = "=(R[-72]C[1])*R2C27/10^9"        Range("G86").Select        Selection.AutoFill Destination:=Range("G86:K86"), Type:=xlFillDefault              '<1M        wbTarget.Sheets(I).Range("F86").Select        ActiveCell.FormulaR1C1 = "=SUM(R[-72]C:R[-72]C[1])*R2C27/10^9"                '>1Y        wbTarget.Sheets(I).Range("L86").Select        ActiveCell.FormulaR1C1 = "=SUM(R[-72]C[1]:R[-72]C[8])*R2C27/10^9"                'Non-Rate        wbTarget.Sheets(I).Range("M86").Select        ActiveCell.FormulaR1C1 = "=SUM(R[-72]C[8])*R2C27/10^9"                'Total        wbTarget.Sheets(I).Range("N86").Select        ActiveCell.FormulaR1C1 = "=SUM(R[-0]C[-8]:R[-0]C[-1])"                             'Customer Loans        '1M - 12M and the rest        wbTarget.Sheets(I).Range("G87").Select        ActiveCell.FormulaR1C1 = "=(SUM(R[-67]C[1])+SUM(R[-66]C[1]))*(R2C27/10^9)"        Range("G87").Select        Selection.AutoFill Destination:=Range("G87:K87"), Type:=xlFillDefault               '<1M        wbTarget.Sheets(I).Range("F87").Select        ActiveCell.FormulaR1C1 = "=(SUM(R[-67]C:R[-67]C[1])+SUM(R[-66]C:R[-66]C[1]))*(R2C27/10^9)"                '>1Y        wbTarget.Sheets(I).Range("L87").Select        ActiveCell.FormulaR1C1 = "=SUM(R[-67]C[1]:R[-67]C[8])+SUM(R[-66]C[1]:R[-66]C[8])*R2C27/10^9"                'Non-Rate        wbTarget.Sheets(I).Range("M87").Select        ActiveCell.FormulaR1C1 = "=SUM(R[-67]C[8]+R[-66]C[8])*R2C27/10^9"            'Total        wbTarget.Sheets(I).Range("N87").Select        ActiveCell.FormulaR1C1 = "=SUM(R[-0]C[-8]:R[-0]C[-1])"                       'Interbank Borrowing        '1M - 12M and the rest        wbTarget.Sheets(I).Range("G90").Select        ActiveCell.FormulaR1C1 = "=((R[-47]C[1])*R2C27/10^9)*-1"        Range("G90").Select        Selection.AutoFill Destination:=Range("G90:K90"), Type:=xlFillDefault                '<1M        wbTarget.Sheets(I).Range("F90").Select        ActiveCell.FormulaR1C1 = "=(SUM(R[-47]C:R[-47]C[1])*R2C27/10^9)*-1"           '>1Y        wbTarget.Sheets(I).Range("L90").Select        ActiveCell.FormulaR1C1 = "=(SUM(R[-47]C[1]:R[-47]C[8])*R2C27/10^9)*-1"             'Non-Rate        wbTarget.Sheets(I).Range("M90").Select        ActiveCell.FormulaR1C1 = "=(SUM(R[-47]C[8])*R2C27/10^9)*-1"            'Total        wbTarget.Sheets(I).Range("N90").Select        ActiveCell.FormulaR1C1 = "=SUM(R[-0]C[-8]:R[-0]C[-1])"                    'CPS/Debt Issued        '1M - 12M and the rest        wbTarget.Sheets(I).Range("G91").Select        ActiveCell.FormulaR1C1 = "=((R[-49]C[1])*R2C27/10^9)*-1"        Range("G91").Select        Selection.AutoFill Destination:=Range("G91:K91"), Type:=xlFillDefault            '<1M        wbTarget.Sheets(I).Range("F91").Select        ActiveCell.FormulaR1C1 = "=(SUM(R[-49]C:R[-49]C[1])*R2C27/10^9)*-1"                '>1Y        wbTarget.Sheets(I).Range("L91").Select        ActiveCell.FormulaR1C1 = "=(SUM(R[-49]C[1]:R[-49]C[8])*R2C27/10^9)*-1"
        'Non-Rate        wbTarget.Sheets(I).Range("M91").Select        ActiveCell.FormulaR1C1 = "=(SUM(R[-49]C[8])*R2C27/10^9)*-1"               'Total        wbTarget.Sheets(I).Range("N91").Select        ActiveCell.FormulaR1C1 = "=SUM(R[-0]C[-8]:R[-0]C[-1])"              'Current Account LIBOR       '1M - 12M and the rest       '<1M       '>1Y       'Non-Rate              'Total        wbTarget.Sheets(I).Range("N92").Select        ActiveCell.FormulaR1C1 = "=SUM(R[-0]C[-8]:R[-0]C[-1])"                        'Current Account Administered       '1M - 12M and the rest               '<1M        wbTarget.Sheets(I).Range("F93").Select        ActiveCell.FormulaR1C1 = "=((SUM(R[-49]C:R[-49]C[1])*R14C27)*R2C27/10^9)*-1"               '>1Y       'Non-Rate             'Total        wbTarget.Sheets(I).Range("N93").Select        ActiveCell.FormulaR1C1 = "=SUM(R[-0]C[-8]:R[-0]C[-1])"                  'Savings Account       '1M - 12M and the rest              '<1M        wbTarget.Sheets(I).Range("F94").Select        ActiveCell.FormulaR1C1 = "=((SUM(R[-50]C:R[-50]C[1])*R15C27)*R2C27/10^9)*-1"               '>1Y       'Non-Rate             'Total        wbTarget.Sheets(I).Range("N94").Select        ActiveCell.FormulaR1C1 = "=SUM(R[-0]C[-8]:R[-0]C[-1])"                             'Fixed Deposits/SD/Others        '1M - 12M and the rest        wbTarget.Sheets(I).Range("G95").Select        ActiveCell.FormulaR1C1 = "=((R[-51]C[1])*R2C27/10^9)*-1"        Range("G95").Select        Selection.AutoFill Destination:=Range("G95:K95"), Type:=xlFillDefault               '<1M        wbTarget.Sheets(I).Range("F95").Select        ActiveCell.FormulaR1C1 = "=((SUM(R[-51]C:R[-51]C[1])*R16C27)*R2C27/10^9)*-1"               '>1Y        wbTarget.Sheets(I).Range("L95").Select        ActiveCell.FormulaR1C1 = "=(SUM(R[-51]C[1]:R[-51]C[8])*R2C27/10^9)*-1"               'Non-Rate        wbTarget.Sheets(I).Range("M95").Select        ActiveCell.FormulaR1C1 = "=((SUM(R[-51]C[8])*R16C27)*R2C27/10^9)*-1"              'Total        wbTarget.Sheets(I).Range("N95").Select        ActiveCell.FormulaR1C1 = "=SUM(R[-0]C[-8]:R[-0]C[-1])"                                 'Derivatives        '1M - 12M and the rest        wbTarget.Sheets(I).Range("G96").Select        ActiveCell.FormulaR1C1 = "=(R[-35]C[1])*R2C27/10^9"        Range("G96").Select        Selection.AutoFill Destination:=Range("G96:K96"), Type:=xlFillDefault              '<1M        wbTarget.Sheets(I).Range("F96").Select        ActiveCell.FormulaR1C1 = "=SUM(R[-35]C:R[-35]C[1])*R2C27/10^9"                '>1Y        wbTarget.Sheets(I).Range("L96").Select        ActiveCell.FormulaR1C1 = "=SUM(R[-35]C[1]:R[-35]C[8])*R2C27/10^9"                'Non-Rate        wbTarget.Sheets(I).Range("M96").Select        ActiveCell.FormulaR1C1 = "=SUM(R[-35]C[8])*R2C27/10^9"                'Total        wbTarget.Sheets(I).Range("N96").Select        ActiveCell.FormulaR1C1 = "=SUM(R[-0]C[-8]:R[-0]C[-1])"                                 'Net Gap        '1M - 12M and the rest        wbTarget.Sheets(I).Range("G97").Select        ActiveCell.FormulaR1C1 = "=SUM(R[-14]C)+SUM(R[-8]C)+SUM(R[-1]C)"        Range("G97").Select        Selection.AutoFill Destination:=Range("G97:N97"), Type:=xlFillDefault                '<1M        wbTarget.Sheets(I).Range("F97").Select        ActiveCell.FormulaR1C1 = "=SUM(R[-14]C)+SUM(R[-8]C)+SUM(R[-1]C)"                 '>1Y        wbTarget.Sheets(I).Range("L97").Select        ActiveCell.FormulaR1C1 = "=SUM(R[-14]C)+SUM(R[-8]C)+SUM(R[-1]C)"              'Non-Rate        wbTarget.Sheets(I).Range("M97").Select        ActiveCell.FormulaR1C1 = "=SUM(R[-14]C)+SUM(R[-8]C)+SUM(R[-1]C)"                'Total        wbTarget.Sheets(I).Range("N97").Select        ActiveCell.FormulaR1C1 = "=SUM(R[-14]C)+SUM(R[-8]C)+SUM(R[-1]C)"                             'Interest Earning Assets        '1M - 12M and the rest, <1MY, >1Y, Non-Rate        wbTarget.Sheets(I).Range("F83").Select        ActiveCell.FormulaR1C1 = "=SUM(R[+1]C:R[+4]C)"        Range("F83").Select        Selection.AutoFill Destination:=Range("F83:M83"), Type:=xlFillDefault                'Total        wbTarget.Sheets(I).Range("N83").Select        ActiveCell.FormulaR1C1 = "=SUM(R[+1]C:R[+5]C)"                    End If        Next I        wb.Close SaveChanges:=True    wbTarget.Close SaveChanges:=True    End Sub

