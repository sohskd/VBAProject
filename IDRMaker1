Public wbTarget As ObjectPublic wb As WorkbookPublic wsSource As WorksheetPublic newSheetName As StringPublic StrFile As String
Sub dataExtractionNISP()' You must set up a workbook and name it in "C:\Users\A9900899\Desktop\Desmond\VBAProject\USDReport.xlsx" as USDReport
    StrFile = Dir(ThisWorkbook.Sheets("Sheet1").Range("W5"))    sPath = ThisWorkbook.Sheets("Sheet1").Range("W5")    targetPath = ThisWorkbook.Sheets("Sheet1").Range("W6")        'Uncomment to see alerts and screen updates    'Application.ScreenUpdating = False    Application.DisplayAlerts = False
    While StrFile <> ""                Debug.Print StrFile & "Entering"                If StrFile Like "*xls*" Then ' check that current file is Excel type                Select Case True            'Case 1            Case (StrFile Like "*" & ThisWorkbook.Sheets("Sheet1").Range("V10") & "*")                        newSheetName = ThisWorkbook.Sheets("Sheet1").Range("W10")            Call searchThroughWorkBook(wb, sPath, StrFile, newSheetName, targetPath)                        Case Else            Debug.Print "Nope!!!"                               End Select                    End If                StrFile = Dir        Debug.Print StrFile & "   Just before i exit, i am going to search for next"            Wend        'Create the IDR Report sheet    Set wbTarget = Workbooks.Open(targetPath & ThisWorkbook.Sheets("Sheet1").Range("W7"))        With wbTarget        .Sheets.Add(After:=.Sheets(.Sheets.Count)).name = "IDR_NII_Sensitivity"        End With    wbTarget.Close SaveChanges:=True        Application.ScreenUpdating = True    Application.DisplayAlerts = True
End Sub
Function createSheet(ByVal nameOfSheet As String, ByRef wbSource As Workbook, ByRef wsSource As Worksheet, ByRef wbTarget As Workbook)        'Copy and Paste everything. Not limited to certain range    With wb.Sheets(wsSource.name).Range("A1:W64")    .Copy        ' Create the new sheet and name it at the end        With wbTarget        .Sheets.Add(After:=.Sheets(.Sheets.Count)).name = nameOfSheet        End With                With wbTarget.Sheets(nameOfSheet).Range(.Address)            .PasteSpecial xlValues            .PasteSpecial xlFormats        End With    End With        'Extra information for some sheets      If nameOfSheet = "NISP_IDR" Then     'Set cell = ActiveSheet.Range("A" & Rows.Count).End(xlUp)     'cell.Offset(3, 3).Activate      ActiveCell(1, 27).Value = "Spot Rate"      ActiveCell(2, 27).Value = "0.000107678956282"      ActiveCell(14, 26).Value = "-8156754948254.12"      ActiveCell(15, 26).Value = "-8999058933976.99"      ActiveCell(16, 26).Value = "-29875560081248.1"      ActiveCell(17, 26).Value = "-145711068087.27"            ActiveCell(1, 25).Value = "Report Date"      ActiveCell(1, 26).Value = "Currency"      ActiveCell(2, 26).Value = "IDR"      ActiveCell(2, 25).Value = "30/12/2016"            ActiveCell(14, 25).Value = "Current Account Deposits"      ActiveCell(15, 25).Value = "Savings Account Deposits"      ActiveCell(16, 25).Value = "Fixed Deposits"      ActiveCell(17, 25).Value = "Other Deposits"      ActiveCell(13, 26).Value = "IDR (June 2016)"      ActiveCell(13, 27).Value = "Scaling Ratio"             ActiveSheet.Range("Z18").Value = "=SUM(Z14:Z17)"            ActiveSheet.Range("AA14").Value = "=Z14/$Z$18"      ActiveSheet.Range("AA15").Value = "=Z15/$Z$18"      ActiveSheet.Range("AA16").Value = "=(Z16+Z17)/$Z$18"      ActiveSheet.Range("AA17").Value = "=(Z16+Z17)/$Z$18"            Range("AA14").NumberFormat = "0.0%"      Range("AA15").NumberFormat = "0.0%"      Range("AA16").NumberFormat = "0.0%"      Range("AA17").NumberFormat = "0.0%"            Range("Z14").NumberFormat = "0.00"      Range("Z15").NumberFormat = "0.00"      Range("Z16").NumberFormat = "0.00"      Range("Z17").NumberFormat = "0.00"      Range("Z18").NumberFormat = "0.00"    End If    End Function
Function searchThroughWorkBook(ByRef wb As Workbook, ByVal sPath As String, ByVal StrFile As String, ByVal newSheetName As String, ByVal targetPath As String)' This function will loop through all the workbooks in a specified folder which contains all the RAW files to extract from.' Open them if the Source Name sheet is what the user wants.' Create the sheet in the Target workbook (End product needed)            Set wb = Workbooks.Open(sPath & StrFile)                    For Each wsSource In wb.Sheets            Debug.Print wsSource.name ' Check sheet name for something you want            If wsSource.name = ThisWorkbook.Sheets("Sheet1").Range("W8") Then                        Set wbTarget = Workbooks.Open(targetPath & ThisWorkbook.Sheets("Sheet1").Range("W7"))                                Call createSheet(newSheetName, wb, wsSource, wbTarget)
                wbTarget.Close SaveChanges:=True                                Exit For
            End If        Next wsSource        wb.Close False ' close workbook and don't save changes    End Function
