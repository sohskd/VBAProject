Public wbTarget As ObjectPublic wb As WorkbookPublic wsSource As WorksheetPublic newSheetName As StringPublic StrFile As String
Sub dataExtractionHKD()' You must set up a workbook and name it in "C:\Users\A9900899\Desktop\Desmond\VBAProject\USDReport.xlsx" as USDReport
    StrFile = Dir(ThisWorkbook.Sheets("Sheet1").Range("H5"))    sPath = ThisWorkbook.Sheets("Sheet1").Range("H5")    targetPath = ThisWorkbook.Sheets("Sheet1").Range("H6")        'Uncomment to see alerts and screen updates    'Application.ScreenUpdating = False    Application.DisplayAlerts = False
    While StrFile <> ""                Debug.Print StrFile & "Entering"                If StrFile Like "*xls*" Then ' check that current file is Excel type                Select Case True            'Case 1            Case (StrFile Like "*" & ThisWorkbook.Sheets("Sheet1").Range("G10") & "*")                        newSheetName = ThisWorkbook.Sheets("Sheet1").Range("H10")            Call searchThroughWorkBook(wb, sPath, StrFile, newSheetName, targetPath)            'Case 2            Case (StrFile Like "*" & ThisWorkbook.Sheets("Sheet1").Range("G11") & "*")                        newSheetName = ThisWorkbook.Sheets("Sheet1").Range("H11")            Call searchThroughWorkBookOWH(wb, sPath, StrFile, newSheetName, targetPath)                        'Case 3            Case (StrFile Like "*" & ThisWorkbook.Sheets("Sheet1").Range("G12") & "*")                        newSheetName = ThisWorkbook.Sheets("Sheet1").Range("H12")            Call searchThroughWorkBookBOS(wb, sPath, StrFile, newSheetName, targetPath)                        Case Else            Debug.Print "Nope!!!"                               End Select                    End If                StrFile = Dir        Debug.Print StrFile & "   Just before i exit, i am going to search for next"            Wend        'Create the USD Report sheet    Set wbTarget = Workbooks.Open(targetPath & ThisWorkbook.Sheets("Sheet1").Range("H7"))        With wbTarget        .Sheets.Add(After:=.Sheets(.Sheets.Count)).name = "HKD_NII_Sensitivity"        End With'        With wbTarget'        .Sheets.Add(Before:=Worksheets(1)).name = "MySheet"'        End With            wbTarget.Close SaveChanges:=True        Application.ScreenUpdating = True    Application.DisplayAlerts = True
End Sub
Function createSheet(ByVal nameOfSheet As String, ByRef wbSource As Workbook, ByRef wsSource As Worksheet, ByRef wbTarget As Workbook)        'Copy and Paste everything. Not limited to certain range    With wb.Sheets(wsSource.name).UsedRange    .Copy        ' Create the new sheet and name it at the end        With wbTarget        .Sheets.Add(After:=.Sheets(.Sheets.Count)).name = nameOfSheet        End With                With wbTarget.Sheets(nameOfSheet).Range(.Address)            .PasteSpecial xlValues            .PasteSpecial xlFormats        End With    End With        'Extra information for some sheets    If nameOfSheet = "HK_HKD" Or nameOfSheet = "OWH_HKD" Then    Set Cell = ActiveSheet.Range("A" & Rows.Count).End(xlUp)    Cell.Offset(3, 3).Activate    'ActiveCell.Value = "Paste The Table Formulas Here"    ActiveSheet.Range("Y2").Value = 0.18649    End If    End Function
Function searchThroughWorkBook(ByRef wb As Workbook, ByVal sPath As String, ByVal StrFile As String, ByVal newSheetName As String, ByVal targetPath As String)' This function will loop through all the workbooks in a specified folder which contains all the RAW files to extract from.' Open them if the Source Name sheet is what the user wants.' Create the sheet in the Target workbook (End product needed)            Set wb = Workbooks.Open(sPath & StrFile)                    For Each wsSource In wb.Sheets            Debug.Print wsSource.name ' Check sheet name for something you want            If wsSource.name = ThisWorkbook.Sheets("Sheet1").Range("H8") Then                        Set wbTarget = Workbooks.Open(targetPath & ThisWorkbook.Sheets("Sheet1").Range("H7"))                                Call createSheet(newSheetName, wb, wsSource, wbTarget)
                wbTarget.Close SaveChanges:=True                                Exit For
            End If        Next wsSource        wb.Close False ' close workbook and don't save changes    End Function
Function searchThroughWorkBookOWH(ByRef wb As Workbook, ByVal sPath As String, ByVal StrFile As String, ByVal newSheetName As String, ByVal targetPath As String)' This function will loop through all the workbooks in a specified folder which contains all the RAW files to extract from.' Open them if the Source Name sheet is what the user wants.' Create the sheet in the Target workbook (End product needed)            Set wb = Workbooks.Open(sPath & StrFile)                    For Each wsSource In wb.Sheets            Debug.Print wsSource.name ' Check sheet name for something you want            If wsSource.name = ThisWorkbook.Sheets("Sheet1").Range("H13") Then                        Set wbTarget = Workbooks.Open(targetPath & ThisWorkbook.Sheets("Sheet1").Range("H7"))                                Call createSheet(newSheetName, wb, wsSource, wbTarget)
                wbTarget.Close SaveChanges:=True                                Exit For
            End If        Next wsSource        wb.Close False ' close workbook and don't save changes    End Function
Function searchThroughWorkBookBOS(ByRef wb As Workbook, ByVal sPath As String, ByVal StrFile As String, ByVal newSheetName As String, ByVal targetPath As String)' This function will loop through all the workbooks in a specified folder which contains all the RAW files to extract from.' Open them if the Source Name sheet is what the user wants.' Create the sheet in the Target workbook (End product needed)        Set wb = Workbooks.Open(sPath & StrFile)                    For Each wsSource In wb.Sheets            Debug.Print wsSource.name ' Check sheet name for something you want            If wsSource.name = ThisWorkbook.Sheets("Sheet1").Range("C21") Then                        'Input ccy to USD in Pivot_Gap so that sheet will display required information            wb.Sheets(wsSource.name).Range("B4") = "HKD"'            Set Cell = ActiveSheet.Range("B4")'            Cell.Offset(3, 3).Activate'            ActiveCell.Value = "USD"                        Set wbTarget = Workbooks.Open(targetPath & ThisWorkbook.Sheets("Sheet1").Range("H7"))                                Call createSheet(newSheetName, wb, wsSource, wbTarget)
                wbTarget.Close SaveChanges:=True                                Exit For
            End If        Next wsSource        wb.Close False ' close workbook and don't save changes    End Function
